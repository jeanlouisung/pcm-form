<div class="container py-5">
  <div *ngIf="!results && progress > 0 && progress < 100" class="alert alert-light text-center py-2 mb-4 border-0 small shadow-sm">
    ✨ Votre progression est sauvegardée automatiquement sur ce navigateur.
  </div>

  <div *ngIf="!results" class="quizz-container">

    <div class="progress-wrapper sticky-top bg-white py-3 mb-4 border-bottom">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="small fw-bold text-muted text-uppercase">Votre progression</span>
        <span class="small fw-bold text-primary">{{ progress }}%</span>
      </div>
      <div class="progress" style="height: 8px;">
        <div class="progress-bar progress-bar-animated"
             role="progressbar"
             [style.width.%]="progress"></div>
      </div>
    </div>

    <div class="header-section text-center mb-5 mt-4">
      <h1 class="display-4 fw-bold">Test de Personnalité PCM</h1>
      <p class="lead text-muted">Sélectionnez et classez les affirmations pour chaque question.</p>
    </div>
    <div *ngFor="let q of questions; let i = index" class="quizz-card mb-5 shadow-sm">
      <div class="quizz-header mb-3">
        <h3 class="h5 fw-bold"><span class="text-primary">#{{ i + 1 }}</span> {{ q.question }}</h3>
      </div>

      <div cdkDropList
           (cdkDropListDropped)="onDrop($event, i)"
           class="answer-list">

        <div *ngFor="let a of q.answers; let idx = index"
             cdkDrag
             class="answer-item d-flex align-items-center"
             [class.is-selected]="a.selected"
             [class.not-selected]="!a.selected"
             (click)="a.selected ? toggleSelection(i, idx, $event) : selectAndPromote(i, idx)">

          <div class="status-dot" [class.active]="a.selected"></div>

          <div class="flex-grow-1 ms-3 answer-text">
            {{ a.label }}
          </div>

          <div class="actions d-flex align-items-center">
            <button type="button"
                    class="btn-action"
                    (click)="toggleSelection(i, idx, $event)"
                    [class.active]="a.selected">
              {{ a.selected ? 'Retirer' : 'Ajouter' }}
            </button>

            <div class="drag-handle ms-3" cdkDragHandle *ngIf="a.selected">
              ⠿
            </div>
          </div>

          <div class="drag-placeholder" *cdkDragPlaceholder></div>
        </div>
      </div>
    </div>

    <div class="footer-actions text-center py-4">
      <button (click)="submitQuizz()"
              class="btn btn-primary btn-lg px-5 rounded-pill shadow"
              [disabled]="progress < 100">
        {{ progress < 100 ? 'Complétez toutes les questions' : 'Voir mon profil' }}
      </button>
    </div>
  </div>

  <div *ngIf="results" class="results-view">
    <app-results-display [data]="results"></app-results-display>
    <div class="text-center mt-4">
      <button (click)="reset()" class="btn btn-outline-primary rounded-pill">Recommencer le test</button>
    </div>
  </div>
</div>
